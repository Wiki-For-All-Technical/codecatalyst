{% extends "base.html" %}
{% block title %}Choose Source{% endblock %}

{% block content %}
{% from 'partials/macros.html' import steps_bar, page_heading %}
{{ steps_bar(3) }}

<div class="card" style="max-width:580px;margin:0 auto;">
    {{ page_heading('Pick Your Source', 'Where should we fetch your photos from?') }}

    <form method="POST" action="{{ url_for('gallery.fetch_images') }}" id="source-form">
        <div class="source-grid">

            <label class="source-card" id="card-photos">
                <input type="radio" name="domain" value="photos" id="rb-photos" onchange="toggleAlbumInput()">
                <div class="source-card-inner">
                    <div class="source-icon">üñºÔ∏è</div>
                    <div class="source-title">Google Photos</div>
                    <div class="source-desc">Shared public album ‚Äî no API key needed</div>
                </div>
            </label>

            <label class="source-card" id="card-drive">
                <input type="radio" name="domain" value="drive" id="rb-drive" checked onchange="toggleAlbumInput()">
                <div class="source-card-inner">
                    <div class="source-icon">üìÅ</div>
                    <div class="source-title">Google Drive</div>
                    <div class="source-desc">Image files from your Drive</div>
                </div>
            </label>

        </div>

        {# ‚îÄ‚îÄ Album URL panel (shown only when Google Photos is selected) ‚îÄ‚îÄ #}
        <div id="album-url-panel" style="display:none;margin-top:20px;">
            <div class="album-instructions">
                <h4>üìã How to share your Google Photos album</h4>
                <ol>
                    <li>Open <a href="https://photos.google.com" target="_blank">photos.google.com</a></li>
                    <li>Go to <strong>Albums</strong> and open the album you want to upload</li>
                    <li>Click the <strong>share icon</strong> (‚ãÆ ‚Üí Share album)</li>
                    <li>Enable <strong>"Anyone with the link"</strong></li>
                    <li>Copy the link and paste it below</li>
                </ol>
            </div>
            <div class="form-group" style="margin-top:14px;">
                <label class="form-label" for="album_url">Shared Album Link</label>
                <input type="url" id="album_url" name="album_url" class="form-control"
                    placeholder="https://photos.app.goo.gl/..." style="font-size:0.9rem;">
                <span class="form-hint">Must be a public Google Photos shared album link</span>
            </div>
        </div>

        <button type="submit" class="btn btn-primary btn-full btn-lg" style="margin-top:22px;" id="fetch-btn">
            Fetch Images ‚Üí
        </button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    function toggleAlbumInput() {
        const isPhotos = document.getElementById('rb-photos').checked;
        const panel = document.getElementById('album-url-panel');
        const input = document.getElementById('album_url');
        panel.style.display = isPhotos ? 'block' : 'none';
        input.required = isPhotos;
    }

    // Initialize on load (Drive is default)
    toggleAlbumInput();
</script>
{% endblock %}